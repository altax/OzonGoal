# –û—Ç—á—ë—Ç –ø–æ –∞—É–¥–∏—Ç—É —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 9 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã:** OWASP Top 10, OAuth 2.0, ISO/IEC 27001

---

## 1. –†–µ–∑—é–º–µ

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ Supabase Auth —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≥–æ—Å—Ç–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞. –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏**, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–Ω.

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –î–û–†–ê–ë–û–¢–ö–ò

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|-----------|--------|-------------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –í—ã—Å–æ–∫–∞—è |
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (RLS) | ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ | ‚úÖ –•–æ—Ä–æ—à–æ | - |
| –ó–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–π | ‚úÖ –•–æ—Ä–æ—à–æ | - |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | –°—Ä–µ–¥–Ω—è—è |
| –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –í—ã—Å–æ–∫–∞—è |

---

## 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (CRITICAL)

### 2.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Row Level Security (RLS) üî¥

**–§–∞–π–ª:** `supabase/migrations/001_initial_schema.sql`  
**–°—Ç—Ä–æ–∫–∏:** 88-91

```sql
CREATE POLICY "Allow all for users" ON users FOR ALL USING (true);
CREATE POLICY "Allow all for goals" ON goals FOR ALL USING (true);
CREATE POLICY "Allow all for shifts" ON shifts FOR ALL USING (true);
CREATE POLICY "Allow all for goal_allocations" ON goal_allocations FOR ALL USING (true);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** RLS –≤–∫–ª—é—á—ë–Ω, –Ω–æ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—é—Ç –õ–Æ–ë–û–ú–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–æ—Å—Ç—É–ø –∫–æ –í–°–ï–ú –¥–∞–Ω–Ω—ã–º. –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ö–æ–¥–∏—Ç –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–í–ª–∏—è–Ω–∏–µ:** 
- –õ—é–±–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –í–°–ï–• –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∞—Ä—É—à–µ–Ω–∏–µ GDPR, ISO 27001 (A.9.4.1 - Information access restriction)
- OWASP A01:2021 - Broken Access Control

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```sql
-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ RLS-–ø–æ–ª–∏—Ç–∏–∫–∏
DROP POLICY "Allow all for goals" ON goals;
CREATE POLICY "Users can only access own goals" ON goals
  FOR ALL USING (user_id = auth.uid());

DROP POLICY "Allow all for shifts" ON shifts;
CREATE POLICY "Users can only access own shifts" ON shifts
  FOR ALL USING (user_id = auth.uid());

DROP POLICY "Allow all for goal_allocations" ON goal_allocations;
CREATE POLICY "Users can access own allocations" ON goal_allocations
  FOR ALL USING (
    shift_id IN (SELECT id FROM shifts WHERE user_id = auth.uid())
  );

DROP POLICY "Allow all for users" ON users;
CREATE POLICY "Users can read own profile" ON users
  FOR SELECT USING (id = auth.uid());
CREATE POLICY "Users can update own profile" ON users
  FOR UPDATE USING (id = auth.uid());
```

---

### 2.2. –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ users üî¥

**–§–∞–π–ª:** `supabase/migrations/001_initial_schema.sql`  
**–°—Ç—Ä–æ–∫–∞:** 17

```sql
password TEXT NOT NULL DEFAULT '',
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∞–±–ª–∏—Ü–∞ `users` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `password`. Supabase Auth —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–æ–ª—è–º–∏ –≤ `auth.users` —Å –Ω–∞–¥–ª–µ–∂–∞—â–∏–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º (bcrypt). –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç:
- –†–∏—Å–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ single source of truth
- OWASP A02:2021 - Cryptographic Failures

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `password` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`.

---

### 2.3. Default User ID - –æ–±—Ö–æ–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ üî¥

**–§–∞–π–ª:** `client/lib/supabase.ts`  
**–°—Ç—Ä–æ–∫–∏:** 18-28

```typescript
export const DEFAULT_USER_ID = '00000000-0000-0000-0000-000000000001';

export async function getCurrentUserId(): Promise<string> {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    return user?.id || DEFAULT_USER_ID;  // Fallback –∫ –æ–±—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!
  } catch (error) {
    return DEFAULT_USER_ID;
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–π DEFAULT_USER_ID. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –í—Å–µ –Ω–µ–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
- –î–∞–Ω–Ω—ã–µ –≥–æ—Å—Ç–µ–π —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
- –í–æ–∑–º–æ–∂–µ–Ω –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
export async function getCurrentUserId(): Promise<string | null> {
  try {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      throw new Error('User not authenticated');
    }
    return user.id;
  } catch (error) {
    console.error('[Supabase] Error getting current user:', error);
    return null; // –Ø–≤–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null, –∞ –Ω–µ fallback
  }
}
```

---

## 3. –í—ã—Å–æ–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (HIGH)

### 3.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è üü†

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `AuthScreen.tsx` –∏ `AuthContext.tsx` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª "–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?".

**–í–ª–∏—è–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç–∞–º –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ AuthContext:
```typescript
const resetPassword = useCallback(async (email: string) => {
  const { error } = await supabase.auth.resetPasswordForEmail(email, {
    redirectTo: `${window.location.origin}/reset-password`,
  });
  return { error };
}, []);
```

---

### 3.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ üü†

**–§–∞–π–ª:** `client/screens/AuthScreen.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 37-51

```typescript
const handleSubmit = async () => {
  if (!email || !password) {
    Alert.alert('–û—à–∏–±–∫–∞', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
    return;
  }
  // –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ email!
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
if (!emailRegex.test(email)) {
  Alert.alert('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email –∞–¥—Ä–µ—Å');
  return;
}
```

---

### 3.3. –°–ª–∞–±–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–∞—Ä–æ–ª–µ–π üü†

**–§–∞–π–ª:** `client/screens/AuthScreen.tsx`  
**–°—Ç—Ä–æ–∫–∞:** 48

```typescript
if (password.length < 6) {
  Alert.alert('–û—à–∏–±–∫–∞', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤');
  return;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤ - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø–æ OWASP:**
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 12+)
- –•–æ—Ç—è –±—ã 1 –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞
- –•–æ—Ç—è –±—ã 1 —Ü–∏—Ñ—Ä–∞
- –•–æ—Ç—è –±—ã 1 —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª

```typescript
const validatePassword = (password: string): string | null => {
  if (password.length < 8) return '–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤';
  if (!/[A-Z]/.test(password)) return '–ú–∏–Ω–∏–º—É–º 1 –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞';
  if (!/[a-z]/.test(password)) return '–ú–∏–Ω–∏–º—É–º 1 —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞';
  if (!/[0-9]/.test(password)) return '–ú–∏–Ω–∏–º—É–º 1 —Ü–∏—Ñ—Ä–∞';
  if (!/[!@#$%^&*]/.test(password)) return '–ú–∏–Ω–∏–º—É–º 1 —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª';
  return null;
};
```

---

### 3.4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö üü†

**–§–∞–π–ª:** `client/contexts/AuthContext.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 42, 142, 157, 172, 188, 208, 217, 229-231, 300, 328

```typescript
console.log(`${LOG_PREFIX} Creating user record for:`, userId);
console.log(`${LOG_PREFIX} Attempting sign in for:`, email);
console.log(`${LOG_PREFIX} Existing session found for:`, session.user.email || session.user.id);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ email, userId –∏ –¥—Ä—É–≥–æ–π PII –≤ –∫–æ–Ω—Å–æ–ª—å.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å–ª–æ–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è:
```typescript
const LOG_ENABLED = __DEV__ || process.env.NODE_ENV === 'development';

const log = (message: string, ...args: any[]) => {
  if (LOG_ENABLED) {
    console.log(`${LOG_PREFIX} ${message}`, ...args);
  }
};
```

---

## 4. –°—Ä–µ–¥–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (MEDIUM)

### 4.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting üü°

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç brute-force –∞—Ç–∞–∫ –Ω–∞ login/signup endpoints.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** 
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –≤ Supabase Dashboard (Auth ‚Üí Settings ‚Üí Rate Limits)
- –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∑–∞—â–∏—Ç—É —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

---

### 4.2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ email üü°

**–§–∞–π–ª:** `client/screens/AuthScreen.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 70-76

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ—á—Ç—ã, –Ω–æ –Ω–µ—Ç:
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –°–æ—Å—Ç–æ—è–Ω–∏—è "–æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å resend confirmation email –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å `email_confirmed_at`.

---

### 4.3. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≥–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º üü°

**–§–∞–π–ª:** `client/contexts/AuthContext.tsx`

```typescript
const continueAsGuest = useCallback(() => {
  console.log(`${LOG_PREFIX} User continuing as guest`);
  setGuestMode(true);
  setUser(null);
  setSession(null);
  setLoading(false);
}, []);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ì–æ—Å—Ç–µ–≤–æ–π —Ä–µ–∂–∏–º —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (AsyncStorage). –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å react-native-keychain –∏–ª–∏ expo-secure-store –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ä–∏—Å–∫–∞—Ö –≥–æ—Å—Ç–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞

---

### 4.4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HTTPS –ø—Ä–æ–≤–µ—Ä–∫–∏ üü°

**–§–∞–π–ª:** `client/lib/supabase.ts`

–ù–µ—Ç —è–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ SUPABASE_URL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
if (!supabaseUrl.startsWith('https://')) {
  throw new Error('Supabase URL must use HTTPS');
}
```

---

## 5. –ù–∏–∑–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (LOW)

### 5.1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ session timeout üü¢

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–∏–æ–¥–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å JWT expiry –≤ Supabase Dashboard –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É.

---

### 5.2. –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö üü¢

**–§–∞–π–ª:** `client/screens/AuthScreen.tsx`

```typescript
if (message.includes('Invalid login')) {
  message = '–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
}
```

**–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ:** –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π (email –∏–ª–∏ –ø–∞—Ä–æ–ª—å). ‚úÖ

---

## 6. –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã ‚úÖ

1. **Supabase Auth** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. **Automatic token refresh** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
3. **Session persistence** - —Å–µ—Å—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **Proper error handling** - –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç —Ä–∞–±–æ—Ç—É
5. **Auth state listener** - —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
6. **Secure password handling** - –ø–∞—Ä–æ–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

---

## 7. –ü–ª–∞–Ω —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ - –¥–æ –∑–∞–ø—É—Å–∫–∞):
| # | –ó–∞–¥–∞—á–∞ | –°—Ä–æ–∫ |
|---|--------|------|
| 1 | –ò—Å–ø—Ä–∞–≤–∏—Ç—å RLS-–ø–æ–ª–∏—Ç–∏–∫–∏ | 1 –¥–µ–Ω—å |
| 2 | –£–¥–∞–ª–∏—Ç—å password –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users | 1 —á–∞—Å |
| 3 | –£–±—Ä–∞—Ç—å DEFAULT_USER_ID fallback | 2 —á–∞—Å–∞ |

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í—ã—Å–æ–∫–∏–µ - –ø–µ—Ä–≤—ã–π —Å–ø—Ä–∏–Ω—Ç):
| # | –ó–∞–¥–∞—á–∞ | –°—Ä–æ–∫ |
|---|--------|------|
| 4 | –î–æ–±–∞–≤–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è | 1 –¥–µ–Ω—å |
| 5 | –£—Å–∏–ª–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–æ–ª—è | 2 —á–∞—Å–∞ |
| 6 | –£–±—Ä–∞—Ç—å PII –∏–∑ –ª–æ–≥–æ–≤ | 2 —á–∞—Å–∞ |

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–µ - –≤—Ç–æ—Ä–æ–π —Å–ø—Ä–∏–Ω—Ç):
| # | –ó–∞–¥–∞—á–∞ | –°—Ä–æ–∫ |
|---|--------|------|
| 7 | –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting | 4 —á–∞—Å–∞ |
| 8 | Email verification flow | 1 –¥–µ–Ω—å |
| 9 | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | 1 –¥–µ–Ω—å |

---

## 8. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º

### OWASP Top 10 (2021)
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| A01 Broken Access Control | ‚ùå | RLS –ø–æ–ª–∏—Ç–∏–∫–∏ "allow all" |
| A02 Cryptographic Failures | ‚ö†Ô∏è | –ü–æ–ª–µ password –≤ users |
| A03 Injection | ‚úÖ | Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã |
| A04 Insecure Design | ‚ö†Ô∏è | DEFAULT_USER_ID pattern |
| A05 Security Misconfiguration | ‚ö†Ô∏è | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç rate limiting |
| A06 Vulnerable Components | ‚úÖ | –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| A07 Auth Failures | ‚ö†Ô∏è | –ù–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è |

### OAuth 2.0 / OpenID Connect
- ‚úÖ Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ JWT —Ç–æ–∫–µ–Ω—ã
- ‚úÖ –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å PKCE flow –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### ISO/IEC 27001
| –ö–æ–Ω—Ç—Ä–æ–ª—å | –°—Ç–∞—Ç—É—Å |
|----------|--------|
| A.9.4.1 Information access restriction | ‚ùå |
| A.9.4.2 Secure log-on procedures | ‚ö†Ô∏è |
| A.9.4.3 Password management system | ‚ö†Ô∏è |
| A.12.4.1 Event logging | ‚ö†Ô∏è |

---

## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –æ—Å–Ω–æ–≤—É (Supabase Auth), –Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ –ø–æ–ª–∏—Ç–∏–∫–∞—Ö –¥–æ—Å—Ç—É–ø–∞**, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –µ—ë –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

**–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å RLS-–ø–æ–ª–∏—Ç–∏–∫–∏
2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ fallback-–º–µ—Ö–∞–Ω–∏–∑–º—ã
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

*–û—Ç—á—ë—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–µ–π OWASP ASVS Level 2*
